#======================================================================
# Load packages
#======================================================================
library(dplyr)
library(bigsnpr)
library(ggmix)
library(data.table)
getwd()
cd("../data")
setwd("../data")
#=======================================================================
# Load the phenotype data
#=======================================================================
#Read phenotype and covariates file
pheno.cov <- read.table("covariate.txt", sep=",", header = T) %>%
mutate(ID=paste(FID,":",IID,sep=""))
n <- nrow(pheno.cov)
#=======================================================================
# Load the genotype data
#=======================================================================
tmpfile <- tempfile()
snp_readBed("geno.bed",backingfile = tmpfile)
# Attach the "bigSNP" object in R session
obj.bigSNP <- snp_attach(paste0(tmpfile, ".rds"))
p <- nrow(obj.bigSNP$map)
G <- bigsnpr::snp_fastImputeSimple(obj.bigSNP$genotypes)[,1:p] %>% scale()
#Read GRM matrix
GRM <- as.matrix(fread("grm.txt.gz"))
colnames(GRM) <- pheno.cov$ID
rownames(GRM) <- pheno.cov$ID
#=======================================================================
# GGMIX
#=======================================================================
fit_ggmix <- ggmix(x = as.matrix(cbind(pheno.cov[,c("AGE","SEX")],G[,1:100])),
y = as.matrix(pheno.cov$y),
standardize = T,
kinship=GRM,
penalty.factor = c(rep(0,2),rep(1,100))
)
str(fit_ggmix)
ls(fit_ggmix)
fit_ggmix$eta
